<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sign in/Sign Up üçç</title>
  <style>
    :root{
      --bg:#0f1720;
      --card:#0b1220;
      --muted:#98a0b3;
      --accent:#7dd3fc;
      --accent-2:#60a5fa;
      --danger:#fb7185;
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:linear-gradient(180deg, #061226 0%, #0b1220 100%);
      color:#e6eef8;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
    }
    .wrap{
      width:100%;
      max-width:920px;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:18px;
    }
    h1{
      margin:0;
      font-size:20px;
      letter-spacing:0.2px;
    }
    p.lead{margin:0;color:var(--muted);font-size:13px}
    .grid{
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:18px;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:18px;
      border-radius:12px;
      box-shadow: 0 6px 18px rgba(2,6,23,0.6);
      border:1px solid rgba(255,255,255,0.03);
    }

    form .row{display:flex;gap:8px;margin-bottom:12px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="text"], textarea, input[type="search"]{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.04);
      background:transparent;
      color:inherit;
      font-size:14px;
      outline:none;
      resize:vertical;
      min-height:38px;
    }
    textarea{min-height:120px}
    .btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
      color:#052029;
      font-weight:600;
      border-radius:10px;
      border:none;
      cursor:pointer;
      box-shadow:0 6px 18px rgba(0,0,0,0.4);
      text-decoration:none;
      font-size:14px;
    }
    .btn.ghost{
      background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03);
    }
    .muted{color:var(--muted);font-size:13px}
    .small{font-size:13px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .admin-actions{display:flex;gap:8px;margin-top:12px}
    .list{
      max-height:520px;
      overflow:auto;
      margin-top:6px;
      display:grid;
      gap:10px;
    }
    .fb-item{
      background:rgba(255,255,255,0.02);
      padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);
    }
    .fb-head{
      display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px;
    }
    .name{
      font-weight:700;
    }
    .time{color:var(--muted);font-size:12px}
    .fb-body{white-space:pre-wrap;color:#dbeafe}
    .danger{background:linear-gradient(90deg,#fb7185,#fb8895); color:#2b0213}
    .toolbar{display:flex;gap:8px;align-items:center}
    .search-wrap{display:flex;gap:8px;align-items:center;flex:1}
    .note{font-size:12px;color:var(--muted);margin-top:8px}
    .empty{
      color:var(--muted);
      text-align:center;padding:36px;border-radius:10px;background:transparent;
      border:1px dashed rgba(255,255,255,0.02);
    }
    footer{margin-top:14px;color:var(--muted);font-size:13px;text-align:center}
    @media (max-width:880px){
      .grid{grid-template-columns:1fr; }
      .card{padding:14px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Sign In/Sign Up üçç (test)</h1>
        <p class="lead">Visitors submit their name + feedback. Admin view protected by a simple password prompt.</p>
      </div>
      <div class="controls">
        <a href="index.html" class="btn">Home</a>
        <button class="btn" id="adminBtn" title="View stored feedback">Admin</button>
        <button class="btn ghost" id="exportBtn" title="Export all feedback (CSV)">Export CSV</button>
      </div>
    </header>

    <div class="grid">
      <!-- Form -->
      <div class="card">
        <form id="feedbackForm" autocomplete="off">
          <label for="name">Your name</label>
          <input id="name" name="name" type="text" maxlength="60" placeholder="Optional ‚Äî or leave blank for anonymous">

          <label for="message">Feedback</label>
          <textarea id="message" name="message" maxlength="3000" placeholder="Write your feedback here..." required></textarea>

          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;margin-top:10px">
            <div class="muted small">Feedback saved locally in your browser (no server).</div>
            <div style="display:flex;gap:8px">
              <button type="submit" class="btn">Sign In/ Sign UP</button>
              <button type="button" class="btn ghost" id="clearFormBtn">Clear</button>
            </div>
          </div>
        </form>

        <p class="note">Tip: share this page with visitors. To view submissions, click Admin (client-side password required).</p>
      </div>

      <!-- Admin area / Viewer -->
      <div class="card" id="viewerCard" style="display:block">
        <div style="display:flex;align-items:center;gap:10px;justify-content:space-between">
          <div>
            <label for="search">Search feedback</label>
            <div class="search-wrap">
              <input id="search" type="search" placeholder="Search by name or text">
              <button class="btn ghost" id="searchClear">Clear</button>
            </div>
          </div>
        </div>

        <div class="admin-actions" style="margin-top:12px">
          <button class="btn ghost" id="showAllBtn">Show all</button>
          <button class="btn ghost" id="deleteSelectedBtn">Delete selected</button>
          <button class="btn ghost danger" id="clearAllBtn">Clear all (irreversible)</button>
        </div>

        <div id="list" class="list" aria-live="polite" style="margin-top:12px"></div>

        <p class="small muted" style="margin-top:10px">You must click <strong>Admin</strong> and enter the password to unlock delete/export features. Export button at top also uses same check.</p>
      </div>
    </div>

    <footer>
      <small>Client-side demo ‚Äî not a production authentication system. For production, send to a server and secure admin properly.</small>
    </footer>
  </div>

<script>
const FEEDBACK_KEY = 'siteFeedback_v1';
const ADMIN_PASSWORD = 'admin123';

function readStorage(){
  try {
    const raw = localStorage.getItem(FEEDBACK_KEY);
    return raw ? JSON.parse(raw) : [];
  } catch(e){ console.error(e); return []; }
}
function writeStorage(arr){
  localStorage.setItem(FEEDBACK_KEY, JSON.stringify(arr));
}
function formatTime(ts){
  const d = new Date(ts);
  return d.toLocaleString();
}

const form = document.getElementById('feedbackForm');
const nameIn = document.getElementById('name');
const msgIn = document.getElementById('message');
const listEl = document.getElementById('list');
const searchIn = document.getElementById('search');
const showAllBtn = document.getElementById('showAllBtn');
const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');
const clearAllBtn = document.getElementById('clearAllBtn');
const adminBtn = document.getElementById('adminBtn');
const exportBtn = document.getElementById('exportBtn');
const searchClear = document.getElementById('searchClear');
const clearFormBtn = document.getElementById('clearFormBtn');

let isAdmin = false;
let selectedIds = new Set();
let lastFilter = '';

function renderList(filter = ''){
  const arr = readStorage();
  const filtered = arr.filter(item => {
    if(!filter) return true;
    const f = filter.toLowerCase();
    return (item.name||'').toLowerCase().includes(f) || (item.message||'').toLowerCase().includes(f);
  }).sort((a,b)=> b.ts - a.ts);

  listEl.innerHTML = '';
  if(filtered.length === 0){
    listEl.innerHTML = '<div class="empty">No feedback found.</div>';
    return;
  }

  filtered.forEach(item => {
    const el = document.createElement('div');
    el.className = 'fb-item';
    el.dataset.id = item.id;

    const head = document.createElement('div');
    head.className = 'fb-head';
    const left = document.createElement('div');
    const nameSpan = document.createElement('div');
    nameSpan.className = 'name';
    nameSpan.textContent = item.name ? item.name : 'Anonymous';
    const timeSpan = document.createElement('div');
    timeSpan.className = 'time';
    timeSpan.textContent = formatTime(item.ts);
    left.appendChild(nameSpan);
    left.appendChild(timeSpan);

    const right = document.createElement('div');
    right.style.display = 'flex';
    right.style.gap = '8px';
    right.style.alignItems = 'center';

    if(isAdmin){
      const chk = document.createElement('input');
      chk.type = 'checkbox';
      chk.title = 'Select for deletion';
      chk.checked = selectedIds.has(item.id);
      chk.addEventListener('change', e=>{
        if(e.target.checked) selectedIds.add(item.id);
        else selectedIds.delete(item.id);
      });
      right.appendChild(chk);

      const del = document.createElement('button');
      del.className = 'btn ghost';
      del.style.padding = '6px 8px';
      del.textContent = 'Delete';
      del.addEventListener('click', ()=>{ deleteItem(item.id); });
      right.appendChild(del);
    }

    head.appendChild(left);
    head.appendChild(right);

    const body = document.createElement('div');
    body.className = 'fb-body';
    body.textContent = item.message;

    el.appendChild(head);
    el.appendChild(body);

    listEl.appendChild(el);
  });
}

function addFeedback(name, message){
  const arr = readStorage();
  const newItem = {
    id: 'fb_' + Math.random().toString(36).slice(2,10),
    name: name ? name.trim() : '',
    message: message.trim(),
    ts: Date.now()
  };
  arr.push(newItem);
  writeStorage(arr);
}

function deleteItem(id){
  if(!isAdmin) return alert('Admin required to delete items.');
  let arr = readStorage();
  arr = arr.filter(x=> x.id !== id);
  writeStorage(arr);
  renderList(lastFilter);
}

function deleteSelected(){
  if(!isAdmin) return alert('Admin required to delete items.');
  if(selectedIds.size === 0) return alert('No items selected.');
  if(!confirm(`Delete ${selectedIds.size} selected item(s)? This cannot be undone.`)) return;
  let arr = readStorage();
  arr = arr.filter(x=> !selectedIds.has(x.id));
  writeStorage(arr);
  selectedIds.clear();
  renderList(lastFilter);
}

function clearAll(){
  if(!isAdmin) return alert('Admin required to clear items.');
  if(!confirm('Clear ALL feedback (this is irreversible)?')) return;
  writeStorage([]);
  selectedIds.clear();
  renderList();
}

function exportCSV(){
  if(!isAdmin){
    if(!unlockAdmin()) return;
  }
  const arr = readStorage().sort((a,b)=> b.ts - a.ts);
  if(arr.length === 0) return alert('No feedback to export.');
  const rows = [['id','name','message','timestamp','iso']];
  arr.forEach(r=>{
    const esc = v => `"${String(v).replace(/"/g,'""')}"`;
    rows.push([esc(r.id), esc(r.name), esc(r.message), r.ts, esc(new Date(r.ts).toISOString())]);
  });
  const csv = rows.map(r => r.join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `feedback_export_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.csv`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
  alert('CSV exported (download started).');
}

function unlockAdmin(){
  if(isAdmin) return true;
  const pw = prompt('Admin password:');
  if(pw === null) return false;
  if(pw === ADMIN_PASSWORD){
    isAdmin = true;
    alert('Admin unlocked.');
    refreshAdminUi();
    return true;
  } else {
    alert('Wrong password.');
    return false;
  }
}

function refreshAdminUi(){
  const adminControls = [deleteSelectedBtn, clearAllBtn, exportBtn];
  adminControls.forEach(btn=>{
    btn.disabled = !isAdmin;
    btn.style.opacity = isAdmin ? '1' : '0.6';
  });
  renderList(lastFilter);
}

form.addEventListener('submit', e=>{
  e.preventDefault();
  const name = nameIn.value;
  const message = msgIn.value;
  if(!message || message.trim().length < 2){
    alert('Please enter feedback (2+ characters).');
    return;
  }
  addFeedback(name, message);
  form.reset();
  renderList(lastFilter);
  alert('Thanks ‚Äî feedback saved locally.');
});

clearFormBtn.addEventListener('click', ()=> form.reset());

adminBtn.addEventListener('click', ()=>{
  if(unlockAdmin()){
    listEl.scrollIntoView({behavior:'smooth'});
  }
});

exportBtn.addEventListener('click', ()=>{
  if(!isAdmin){
    if(!unlockAdmin()) return;
  }
  exportCSV();
});

showAllBtn.addEventListener('click', ()=>{
  searchIn.value = '';
  lastFilter = '';
  renderList();
});

deleteSelectedBtn.addEventListener('click', ()=>{
  if(!isAdmin){
    if(!unlockAdmin()) return;
  }
  deleteSelected();
});

clearAllBtn.addEventListener('click', ()=>{
  if(!isAdmin){
    if(!unlockAdmin()) return;
  }
  clearAll();
});

searchIn.addEventListener('input', (e)=>{
  lastFilter = e.target.value;
  renderList(lastFilter);
});
searchClear.addEventListener('click', ()=>{
  searchIn.value = '';
  lastFilter = '';
  renderList();
});

document.addEventListener('keydown', (e)=>{
  if(e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'a'){
    adminBtn.click();
  }
});

refreshAdminUi();
renderList();
</script>
</body>
</html>
